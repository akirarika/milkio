<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æŒä¹…åŒ–é©±åŠ¨ | Kurimudb</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.5c9146cd.css" as="style"><link rel="preload" href="/assets/js/app.7e5a56f6.js" as="script"><link rel="preload" href="/assets/js/2.f2cf2d77.js" as="script"><link rel="preload" href="/assets/js/16.980fcefa.js" as="script"><link rel="prefetch" href="/assets/js/10.f1a8a5ca.js"><link rel="prefetch" href="/assets/js/11.ac418491.js"><link rel="prefetch" href="/assets/js/12.58680d0b.js"><link rel="prefetch" href="/assets/js/13.23121e19.js"><link rel="prefetch" href="/assets/js/14.33766b90.js"><link rel="prefetch" href="/assets/js/15.66fdfce1.js"><link rel="prefetch" href="/assets/js/17.66f1317e.js"><link rel="prefetch" href="/assets/js/3.687039bb.js"><link rel="prefetch" href="/assets/js/4.ee26d59f.js"><link rel="prefetch" href="/assets/js/5.9f0bec47.js"><link rel="prefetch" href="/assets/js/6.e5162ba1.js"><link rel="prefetch" href="/assets/js/7.13c4e88b.js"><link rel="prefetch" href="/assets/js/8.af4741f6.js"><link rel="prefetch" href="/assets/js/9.50b164a7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5c9146cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kurimudb</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <ul class="color-theme-options"><li><a href="#" class="default-theme"></a></li> <li><a href="#" class="blue-theme"></a></li><li><a href="#" class="red-theme"></a></li><li><a href="#" class="purple-theme"></a></li></ul> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <div class="ignore-themes-options toggle-option"><label for="ignore-themes-toggle">Ignore Other Themes?</label> <input id="ignore-themes-toggle" type="checkbox"></div> <!----></div></div></div> <!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°æ—¥å¿—
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°æ—¥å¿—
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">ä»‹ç»</a></li><li><a href="/intro/" class="sidebar-link">å…¥é—¨</a></li><li><a href="/typescript/" class="sidebar-link">Typescript</a></li><li><a href="/cache/" class="sidebar-link">è®¢é˜…æ›´æ–° (ç¼“å­˜é©±åŠ¨)</a></li><li><a href="/persistence/" aria-current="page" class="active sidebar-link">æŒä¹…åŒ–é©±åŠ¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/persistence/#localstorage" class="sidebar-link">LocalStorage</a></li><li class="sidebar-sub-header"><a href="/persistence/#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/persistence/#dexie-js-indexeddb" class="sidebar-link">Dexie.js (IndexedDB)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/persistence/#ç‰ˆæœ¬æ§åˆ¶" class="sidebar-link">ç‰ˆæœ¬æ§åˆ¶</a></li><li class="sidebar-sub-header"><a href="/persistence/#æŸ¥è¯¢æ„é€ å™¨" class="sidebar-link">æŸ¥è¯¢æ„é€ å™¨</a></li><li class="sidebar-sub-header"><a href="/persistence/#åŒ…è£…æŸ¥è¯¢ç»“æœ" class="sidebar-link">åŒ…è£…æŸ¥è¯¢ç»“æœ</a></li><li class="sidebar-sub-header"><a href="/persistence/#åŒ…è£…å•ä¸ªç»“æœ" class="sidebar-link">åŒ…è£…å•ä¸ªç»“æœ</a></li><li class="sidebar-sub-header"><a href="/persistence/#å¤ç”¨æŸ¥è¯¢é€»è¾‘" class="sidebar-link">å¤ç”¨æŸ¥è¯¢é€»è¾‘</a></li></ul></li></ul></li><li><a href="/more/" class="sidebar-link">æ·±å…¥</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="æŒä¹…åŒ–é©±åŠ¨"><a href="#æŒä¹…åŒ–é©±åŠ¨" class="header-anchor">#</a> æŒä¹…åŒ–é©±åŠ¨</h1> <p>åœ¨<a href="/intro/">å…¥é—¨ç« èŠ‚</a>ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šæŒä¹…åŒ–å±‚çš„é©±åŠ¨ï¼Œæ‰€ä»¥é¡µé¢ä¸€æ—¦åˆ·æ–°ï¼Œæ•°æ®å°±å…¨éƒ¨ä¸¢æ‰äº†ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ­¤æ¨¡å‹çš„æ•°æ®åœ¨é¡µé¢åˆ·æ–°åä¾æ—§å­˜åœ¨ï¼Œå¯ä»¥æŒ‡å®šæŒä¹…åŒ–å±‚çš„é©±åŠ¨ã€‚</p> <h2 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> LocalStorage</h2> <p><a href="https://developer.mozilla.org/docs/Web/API/Window/localStorage" target="_blank" rel="noopener noreferrer">LocalStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸€èˆ¬å¯ä»¥å­˜å‚¨çº¦ 5MB å·¦å³çš„æ•°æ®ã€‚</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// /models/configModel.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> BehaviorSubject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> RxjsDriver<span class="token punctuation">,</span> LocalStorageDriver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;kurimudb&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  config<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;config&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    drivers<span class="token operator">:</span> <span class="token punctuation">{</span>
      cache<span class="token operator">:</span> RxjsDriver<span class="token punctuation">,</span>
      cacheInject<span class="token operator">:</span> BehaviorSubject<span class="token punctuation">,</span>
      <span class="token comment">// æŒ‡å®šæŒä¹…åŒ–é©±åŠ¨ä½¿ç”¨ LocalStorageDriver å³å¯ï¼Œæœ¬é©±åŠ¨æ— éœ€ä¾èµ–æ³¨å…¥</span>
      persistence<span class="token operator">:</span> LocalStorageDriver<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½¿ç”¨çš„è¯ï¼Œè·Ÿå‰æ–‡ä¸€è‡´ï¼Œä¸éœ€è¦æ”¹åŠ¨ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæˆ–æ›´æ–°..</span>
<span class="token keyword">const</span> say <span class="token operator">=</span> configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">;</span> <span class="token comment">// è¯»å–..</span>
<span class="token keyword">delete</span> configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤..</span>
<span class="token string">&quot;say&quot;</span> <span class="token keyword">in</span> configModel<span class="token punctuation">.</span>data<span class="token punctuation">;</span> <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨..</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„äº‹é¡¹</p> <p>LocalStorage æ‰€å­˜å‚¨çš„å†…å®¹ï¼Œæœ¬è´¨éƒ½æ˜¯å­˜ä¸ºå­—ç¬¦ä¸²ã€‚LocalStorage é©±åŠ¨ä¼šå¯¹å­˜å…¥çš„æ•°æ®è¿›è¡Œ <code>JSON.stringify</code>ï¼Œæ‰€ä»¥ï¼Œè¯·å‹¿å­˜å…¥æ— æ³•è¢«æ­£ç¡® <code>JSON.stringify</code> çš„å¯¹è±¡ (å¦‚ <code>Set</code>ã€<code>Map</code> ç­‰)ã€‚</p></div> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h2> <p>å¾…ç»­ ğŸ¸</p> <h2 id="dexie-js-indexeddb"><a href="#dexie-js-indexeddb" class="header-anchor">#</a> Dexie.js (IndexedDB)</h2> <p>IndexedDB çš„å®¹é‡å’Œ<a href="https://web.dev/storage-for-the-web/#how-much" target="_blank" rel="noopener noreferrer">ç”¨æˆ·ç¡¬ç›˜å¤§å°æœ‰å…³<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œå¯ä»¥ç›´æ¥å­˜å‚¨ JavaScript å¯¹è±¡ã€‚æ³¨æ„ï¼Œå’Œ LocalStorage ä¸åŒçš„æ˜¯ï¼Œ <strong>IndexedDB æ˜¯å¼‚æ­¥çš„ã€‚</strong> <a href="https://dexie.org/" target="_blank" rel="noopener noreferrer">Dexie.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åˆ™æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§çš„ IndexedDB çš„åŒ…è£…å™¨ï¼ŒGithub ä¸Šæœç´¢ IndexedDBï¼Œå®ƒåœ¨ç»“æœä¸­æ’åç¬¬ä¸€ã€‚</p> <h3 id="ç‰ˆæœ¬æ§åˆ¶"><a href="#ç‰ˆæœ¬æ§åˆ¶" class="header-anchor">#</a> ç‰ˆæœ¬æ§åˆ¶</h3> <p>åœ¨ä½¿ç”¨ Dexie å‰ï¼Œéœ€è¦å…ˆå£°æ˜æ•°æ®åº“çš„ç‰ˆæœ¬ï¼Œæ¨èé˜…è¯» <a href="https://dexie.org/docs/Tutorial/Design#database-versioning" target="_blank" rel="noopener noreferrer">Dexie å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œä¸‹æ–¹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ª /models/migrations/index.js æ–‡ä»¶</span>

<span class="token keyword">import</span> Dexie <span class="token keyword">from</span> <span class="token string">&quot;dexie&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">&quot;kurimudb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ä¸€ä¸ªè¡¨å¯¹åº”ä¸€ä¸ªæ¨¡å‹ï¼Œéœ€å’Œæ¨¡å‹åä¸€è‡´ã€‚æ¨¡å‹çš„ä¸»é”®åç§°é»˜è®¤ä¸º idï¼Œæ‰€ä»¥è¡¨ä¹Ÿéœ€è¦å°†ä¸»é”®è®¾ç½®ä¸º id</span>
  config<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// ++id ä»£è¡¨ä¸»é”®æ˜¯è‡ªå¢çš„</span>
  note<span class="token operator">:</span> <span class="token string">&quot;++id&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  _seed<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ºäº†ä½¿ kurimudb çš„å¡«å……åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»åˆ›å»ºæ­¤è¡¨</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> db<span class="token punctuation">;</span>
</code></pre></div><p><em>ç‰ˆæœ¬çš„é¡ºåºæ˜¯ä¸é‡è¦çš„ï¼ŒDexie.js ä¼šåœ¨è¿ç§»ä¸åŒç‰ˆæœ¬æ—¶ï¼Œè‡ªåŠ¨å¯¹ç‰ˆæœ¬è¿›è¡Œæ’åºã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥æŠŠæ–°çš„ç‰ˆæœ¬å†™åœ¨ä¸Šé¢ï¼Œé¿å…æœªæ¥ç‰ˆæœ¬è¿‡å¤šæ—¶ï¼Œé™ä½ä»£ç å¯è¯»æ€§ã€‚</em></p> <p>ç„¶åæŠŠå®ƒæ”¾åœ¨æ¨¡å‹ä¸­ä¾èµ–æ³¨å…¥å³å¯ï¼š</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><div class="highlighted">Â </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// /models/noteModel.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> BehaviorSubject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> RxjsDriver<span class="token punctuation">,</span> DexieDriver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;kurimudb&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> migrations <span class="token keyword">from</span> <span class="token string">&quot;./migrations/index&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  config<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;note&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
    drivers<span class="token operator">:</span> <span class="token punctuation">{</span>
      cache<span class="token operator">:</span> RxjsDriver<span class="token punctuation">,</span>
      cacheInject<span class="token operator">:</span> BehaviorSubject<span class="token punctuation">,</span>
      <span class="token comment">// æŒ‡å®šæŒä¹…åŒ–é©±åŠ¨ä½¿ç”¨ DexieDriver</span>
      persistence<span class="token operator">:</span> DexieDriver<span class="token punctuation">,</span>
      <span class="token comment">// å‘æŒä¹…åŒ–å±‚ä¾èµ–æ³¨å…¥ä½ ä¸Šé¢åˆ›å»ºçš„ /models/migrations/index.js æ–‡ä»¶ï¼Œ</span>
      <span class="token comment">// å³ä¼ å…¥ä¸€ä¸ªå·²åˆ›å»ºå¥½ç‰ˆæœ¬çš„ Dexie å®ä¾‹å³å¯</span>
      persistenceInject<span class="token operator">:</span> migrations<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨æ¨¡å‹å•¦ï¼Œæ¨¡å‹çš„æ•°æ®ä¼šè¢«æŒä¹…åŒ–åˆ° IndexedDB ä¸­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæˆ–æ›´æ–°..</span>
<span class="token keyword">const</span> say <span class="token operator">=</span> <span class="token keyword">await</span> configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">;</span> <span class="token comment">// è¯»å–ï¼Œç”±äº IndexedDB æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥éœ€è¦åŠ  await..</span>
<span class="token keyword">delete</span> configModel<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤..</span>
configModel<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">&quot;say&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨..</span>
</code></pre></div><h3 id="æŸ¥è¯¢æ„é€ å™¨"><a href="#æŸ¥è¯¢æ„é€ å™¨" class="header-anchor">#</a> æŸ¥è¯¢æ„é€ å™¨</h3> <p>æœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸€ç³»åˆ—æ¡ä»¶æ¥ç­›é€‰å‡ºä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="https://dexie.org/docs/Table/Table" target="_blank" rel="noopener noreferrer">Dexie<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä»¥é“¾å¼è°ƒç”¨çš„è¯­æ³•ï¼Œæ¥ç¼–å†™æŸ¥è¯¢æ¡ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æŸ¥è¯¢ id å°äº 5 çš„ä¾¿ç­¾</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getResults</span><span class="token punctuation">(</span>
  noteModel
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// query å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ­¤æ¨¡å‹çš„ [Dexie Table å¯¹è±¡](https://dexie.org/docs/Table/Table)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åŒ…è£…æŸ¥è¯¢ç»“æœ"><a href="#åŒ…è£…æŸ¥è¯¢ç»“æœ" class="header-anchor">#</a> åŒ…è£…æŸ¥è¯¢ç»“æœ</h3> <p><code>noteModel.getResults()</code> å‡½æ•°ä¼šå¯¹ Dexie æŸ¥è¯¢å‡ºçš„ç»“æœ (<code>Promise&lt;Array&lt;any&gt;&gt;</code>) è¿›è¡ŒåŒ…è£…ï¼Œ<strong>åŒæ—¶æ•°æ®ä¹Ÿä¼šè¢«ç¼“å­˜åˆ°ç¼“å­˜å±‚</strong>ã€‚é»˜è®¤åŒ…è£…æˆå¯¹è±¡ï¼Œå¯¹è±¡çš„é”®ä¸ºå€¼çš„ä¸»é”®ã€‚å¦‚æœä½ éœ€è¦æ•°ç»„ï¼Œåˆ™å¯ä»¥å‘ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ <code>[]</code>ï¼š</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted">Â </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getResults</span><span class="token punctuation">(</span>
  noteModel
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥ä¼ å…¥éç©ºçš„æ•°ç»„æˆ–å¯¹è±¡ï¼ŒæŸ¥è¯¢å‡ºçš„ç»“æœä¼šåœ¨åŸæ¥çš„æ•°æ®æœ«å°¾è¿½åŠ ï¼š</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br></div><pre class="language-js"><code><span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getResults</span><span class="token punctuation">(</span>
  noteModel
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getResults</span><span class="token punctuation">(</span>
  noteModel
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    hello<span class="token operator">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…è°ƒç”¨ <code>getArrayResults()</code> å’Œ <code>getObjectResults()</code> ä¹Ÿè¡Œï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getObjectResults</span><span class="token punctuation">(</span>noteModel<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getArrayResults</span><span class="token punctuation">(</span>noteModel<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åŒ…è£…å•ä¸ªç»“æœ"><a href="#åŒ…è£…å•ä¸ªç»“æœ" class="header-anchor">#</a> åŒ…è£…å•ä¸ªç»“æœ</h3> <p>å¦‚æœ Dexie.js çš„æŸ¥è¯¢ç»“æœåªä¼šæœ‰ä¸€ä¸ª (å¦‚ <code>first</code> å‡½æ•°)ï¼Œé‚£ä¹ˆè¯·ç”¨ <code>getResult</code> å‡½æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> userModel<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span>
  userModel
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;akirarika&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å¤ç”¨æŸ¥è¯¢é€»è¾‘"><a href="#å¤ç”¨æŸ¥è¯¢é€»è¾‘" class="header-anchor">#</a> å¤ç”¨æŸ¥è¯¢é€»è¾‘</h3> <p>æˆ‘ä»¬æ›´æ¨èå°†æŸ¥è¯¢å†™åœ¨æ¨¡å‹å†…éƒ¨ï¼Œä»¥ä¾¿å®ç°ä»£ç çš„å¤ç”¨ã€‚</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// /models/noteModel.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  config<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token keyword">async</span> <span class="token function">getIdBelow5Results</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResults</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">below</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨æ—¶..</span>
<span class="token keyword">await</span> noteModel<span class="token punctuation">.</span><span class="token function">getIdBelow5Results</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">æ·±å…¥äº†è§£ Dexie</p> <p>Dexie æ‹¥æœ‰å¼ºå¤§åˆç®€æ´æ˜ç¡®çš„æŸ¥è¯¢ Apiï¼Œå¼ºçƒˆæ¨èé˜…è¯» <a href="https://dexie.org/docs/API-Reference" target="_blank" rel="noopener noreferrer">Dexie æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ <a href="https://dexie.org/docs/Tutorial/Best-Practices#1-understand-promises" target="_blank" rel="noopener noreferrer">Dexie æœ€ä½³å®è·µ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/cache/" class="prev">
        è®¢é˜…æ›´æ–° (ç¼“å­˜é©±åŠ¨)
      </a></span> <span class="next"><a href="/more/">
        æ·±å…¥
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7e5a56f6.js" defer></script><script src="/assets/js/2.f2cf2d77.js" defer></script><script src="/assets/js/16.980fcefa.js" defer></script>
  </body>
</html>
