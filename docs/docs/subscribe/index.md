# è®¢é˜…å˜æ›´

## è®¢é˜…

Kurimudb ä¸­ï¼Œ`$` ç¬¦å·ä»£è¡¨ `subscribe` çš„ç®€å†™ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªå€¼åŽåŠ ä¸Š `$` ç¬¦å·æ¥è®¢é˜…å®ƒçš„å˜æ›´ï¼š

```js
configState.data.foo$((value, key) => {
  console.log(value, key);
});
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œé—­åŒ…å‡½æ•°ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œæ–¹ä¾¿ä½ ä¸ºä½ è§†å›¾ä¸­çš„å“åº”å¼å˜é‡èµ‹åˆå§‹å€¼ã€‚å¦‚æžœä½ ä¸å¸Œæœ›è¿™ä¹ˆåšï¼Œè€Œæ˜¯åªåœ¨åŽç»­å€¼å˜æ›´æ—¶æ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä¸‹å³å¯ï¼š

```js {5}
configState.data.foo$(
  (value, key) => {
    console.log(value, key);
  },
  { immediate: false },
);
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨[ç±» Storage Api](/docs/model/#%E7%B1%BB-storage-api) çš„å½¢å¼è¿›è¡Œè®¢é˜…ï¼š

```js
configState.subscribeItem(key, closFunc, config);
```

## æ‰¹é‡è®¢é˜…

å¦‚æžœä½ æƒ³ä¸€æ¬¡è®¢é˜…å¤šä¸ªå€¼çš„å˜æ›´ï¼Œå¯ä»¥ä½¿ç”¨ `batch$` å‡½æ•°ï¼š

```js
import { batch$ } from 'kurimudb';

batch$([configState.data.foo$, configState.data.bar$], (value, key) => {
  console.log(value, key);
});
```

## è‡ªåŠ¨è®¢é˜…

æ‰‹åŠ¨å£°æ˜Žè¦è®¢é˜…çš„å€¼å¯èƒ½ä¼šæœ‰äº›ç¹çï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ã€‚å½“ä½ åœ¨é—­åŒ…ä¸­æ‰€ä½¿ç”¨çš„å€¼æœ‰ä»»ä¸€è¢«æ›´æ”¹æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡è®¢é˜…ï¼š

```js
configState.auto$(() => {
  console.log(configState.data.foo);
  console.log(configState.data.bar);
});
```

åœ¨é—­åŒ…å‡½æ•°çš„é¦–æ¬¡æ‰§è¡Œè¿‡ç¨‹æ—¶ï¼ŒKurimudb ä¼šæ”¶é›†å…¶ä¸­å“ªäº›å€¼è¢«è¯»å–ï¼ŒéšåŽè®¢é˜…å®ƒä»¬ï¼Œå› æ­¤ï¼Œé—­åŒ…å‡½æ•°**å¿…é¡»æ˜¯åŒæ­¥çš„**ã€‚

## å…¨å±€è‡ªåŠ¨è®¢é˜…

å‰æ–‡è‡ªåŠ¨è®¢é˜…åŠŸèƒ½çš„**èŒƒå›´æ˜¯ä½ çš„æ¨¡åž‹**ï¼Œå¦‚æžœä½ åœ¨å…¶ä¸­è¯»å–äº†å¤–éƒ¨æ¨¡åž‹çš„æ•°æ®ï¼Œæ˜¯ä¸ä¼šè¢«è®¢é˜…çš„ã€‚å¦‚æžœä½ æƒ³è‡ªåŠ¨è®¢é˜…ä»»ä¸€æ¨¡åž‹çš„æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¨å±€è‡ªåŠ¨è®¢é˜…ï¼š

```js
import { auto$ } from 'kurimudb';

auto$(() => {
  console.log(fooState.data.foo);
  console.log(barState.data.bar);
});
```

::: warning æ³¨æ„äº‹é¡¹

å’Œè‡ªåŠ¨è®¢é˜…åŠŸèƒ½ä¸åŒï¼Œç”±äºŽ JavaScript çš„é™åˆ¶ï¼Œå…¨å±€è‡ªåŠ¨è®¢é˜…åŠŸèƒ½ä¸é€‚ç”¨äºŽ**å¼‚æ­¥æ¨¡åž‹**ã€‚æˆ‘ä»¬æƒ³åˆ°äº†ä¸€ç§å˜é€šçš„æ–¹å¼ï¼Œæ¥å®žçŽ°æ”¯æŒå¼‚æ­¥æ¨¡åž‹çš„å…¨å±€è‡ªåŠ¨è®¢é˜…åŠŸèƒ½ï¼Œä½†æ˜¯æ­¤åŠŸèƒ½è¿˜åœ¨å¼€å‘ä¸­ã€‚

:::

## è®¢é˜…æ¨¡åž‹

ä½ è¿˜å¯ä»¥è®¢é˜…æ•´ä¸ªæ¨¡åž‹çš„å˜æ›´ï¼Œå½“æ¨¡åž‹ä¸­æœ‰ä»»ä¸€å€¼å˜æ›´æ—¶ï¼Œé—­åŒ…å‡½æ•°éƒ½ä¼šè§¦å‘ã€‚

è¿™é€šå¸¸ç”¨äºŽä½ ä¸çŸ¥é“è¦è®¢é˜…çš„æ˜¯å“ªä¸ªå€¼çš„åœºæ™¯ï¼Œå¦‚**é›†åˆæ¨¡åž‹**ä¸Šã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼šå­˜å‚¨è‰ç¨¿çš„é›†åˆæ¨¡åž‹ï¼Œè§†å›¾éœ€è¦åœ¨ç”¨æˆ·ä¿å­˜/æ–°å¢ž/åˆ é™¤è‰ç¨¿æ—¶å³æ—¶å˜åŒ–ï¼Œè¿™æ—¶å°±æ´¾ä¸Šç”¨åœºå•¦ã€‚

æƒ³è¦è®¢é˜…æ¨¡åž‹çš„å˜æ›´ï¼Œåªéœ€è¦è°ƒç”¨ `yourModel.$` å‡½æ•°å³å¯ï¼š

```js {3,4,5}
ref: currentDraftData = [];

draftList.$((key) => {
  currentDraftData = draftList.all();
});

// in view..

draftList.insert({
  // ..
});
```

## é€€è®¢

å½“ä½ æ‰§è¡Œäº†è®¢é˜…å‡½æ•°åŽï¼Œè¿”å›žå€¼å°†æ˜¯ä¸€ä¸ªé€€è®¢å‡½æ•°ï¼Œæ‰§è¡Œå®ƒï¼Œä¼šå°†æ­¤è®¢é˜…é€€è®¢ï¼š

```js
const unsubscribe = configState.data.foo$((value, key) => {
  // ..
});

// é€€è®¢
unsubscribe();
```

## è‡ªåŠ¨é€€è®¢

å¦‚æžœä½ æ­£åœ¨ä½¿ç”¨ Vue/React ç­‰æ¡†æž¶ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›ï¼Œåœ¨ç»„ä»¶è¢«é”€æ¯æ—¶ï¼Œè‡ªåŠ¨é€€è®¢æ­¤ç»„ä»¶ä¸­äº§ç”Ÿçš„æ‰€æœ‰è®¢é˜…ã€‚

ä½ å¯ä»¥å‘ `kurimudbConfig.autoUnsubscribe` ä¸ŠæŒ‚è½½ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œè®¢é˜…å‡½æ•°æ—¶æ‰§è¡Œï¼Œä½ å¯ä»¥åˆ©ç”¨å®ƒç»“åˆæ‰€ä½¿ç”¨æ¡†æž¶çš„ç”Ÿå‘½å‘¨æœŸ Apiï¼Œæ¥å®žçŽ°è‡ªåŠ¨é€€è®¢ã€‚

### Vue3

```js
import { onBeforeUnmount } from 'vue';
import { kurimudbConfig } from 'kurimudb';

kurimudbConfig.autoUnsubscribe = (unsubscribe) => {
  onBeforeUnmount(() => unsubscribe());
};
```

### React

å¾…ç»­ ðŸ¸

### å¿½ç•¥è‡ªåŠ¨é€€è®¢

å¦‚æžœä½ ä½¿ç”¨äº†è‡ªåŠ¨é€€è®¢åŠŸèƒ½ï¼Œå´åˆä¸å¸Œæœ›éƒ¨åˆ†åœºæ™¯ä¸‹è‡ªåŠ¨é€€è®¢ï¼Œå¦‚ä¸‹å³å¯ï¼š

```js {5}
configState.data.foo$(
  (value, key) => {
    console.log(value, key);
  },
  { autoUnsubscribe: false },
);
```
