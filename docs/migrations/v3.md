# ä» v3 è¿ç§»

Kurimudb 4.x ç‰ˆæœ¬ç›¸è¾ƒäº 3.x ç‰ˆæœ¬æœ‰è®¸å¤šå˜åŒ–ï¼Œå®ƒä»¬å¯èƒ½æ˜¯ä¸€äº›æ–°ç‰¹æ€§ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€äº›ä¸å…¼å®¹çš„æ›´æ”¹ï¼Œæœ¬æ–‡æ¡£ä¼šè¯¦ç»†ä¸ºä½ é˜è¿°å…¶ä¸­çš„å…·ä½“å˜åŒ–ã€‚

::: warning æ³¨æ„äº‹é¡¹

ä» Kurimudb 4.0 å¼€å§‹ï¼Œå°†éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/)ã€‚å› æ­¤ï¼Œæœ¬ä»½æ–‡æ¡£å°†è¯´æ˜ä» 3.0 åˆ° 4.0 çš„å˜åŒ–ã€‚

å‘œå‘œå‘œï¼Œéå¸¸å¯¹ä¸èµ· > <

:::

## ç ´åæ€§å˜åŒ–

### æ¨¡å‹å®šä¹‰

4.x ç‰ˆæœ¬ä¸­åœ¨å®šä¹‰æ¨¡å‹ä¸Šï¼Œå¢åŠ äº†ä¸€äº›é»˜è®¤å€¼å’Œè‡ªåŠ¨æ¨æ–­ã€‚

```js
export default new class ConfigState extends Models.keyValue<
// 4.x ç‰ˆæœ¬ä¸­ï¼Œå®šä¹‰ data çš„ç±»å‹ä¸å†æ˜¯å¿…é¡»çš„ï¼Œé»˜è®¤ä¸º Record<string | number, any>
// Record<string | number, any>
> {
  constructor() {
    super({
      // 4.x ç‰ˆæœ¬ä¸­ï¼Œæ¨¡å‹åç§°å¯çœç•¥ã€‚çœç•¥å°†ä½¿ç”¨å½“å‰ç±»çš„ç±»å
      // name: "ConfigState", 
      // 4.x ç‰ˆæœ¬ä¸­ï¼Œç±»å‹å¯çœç•¥ã€‚è‹¥çœç•¥ï¼Œé”®å€¼å¯¹æ¨¡å‹å°†ä¸º 'string'ï¼Œé›†åˆæ¨¡å‹å°†ä¸º 'number'
      // type: "string",
    });
  }
};
```

### æ¨¡å‹åŠŸèƒ½

- `yourModel.all()` å‡½æ•°å˜æ›´ä¸ºä»…åœ¨é›†åˆæ¨¡å‹ä¸‹å¯ç”¨ã€‚

- å½“å–æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼ŒåŸå…ˆä¼šè·å¾— `null`ï¼Œç°åœ¨ä¼šè·å¾— `undefined`ã€‚

### æ¨¡å‹è®¢é˜…

åŸå…ˆæ‰¹é‡è®¢é˜…å‡½æ•°çš„è¿”å›å€¼ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰é€€è®¢çš„å„ä¸ªå€¼çš„æ•°ç»„ï¼Œç°åœ¨è¿”å›å€¼è¢«å˜æ›´ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œåé€€è®¢æ­¤æ¬¡æ‰¹é‡è®¢é˜…çš„å…¨éƒ¨å€¼ã€‚

```js
// 3.x ç‰ˆæœ¬
const unsubscribeFunctions = batch$(...);
for (const unsubscribe of unsubscribeFunctions) {
    unsubscribe();
}

// 4.x ç‰ˆæœ¬
const unsubscribe = batch$(...);
unsubscribe();
```

### ç±» Storage Api

ç°åœ¨ç±» Storage Api ä¸­çš„ `subscribeItem` å‡½æ•°ï¼Œè¯­æ³•å˜æ›´å¦‚ä¸‹ï¼š

```js
// 3.x ç‰ˆæœ¬
local.subscribeItem("say")((val) => { ... });
// 4.x ç‰ˆæœ¬
local.subscribeItem("say", (val) => { ... });
```

## æ–°åŠŸèƒ½å’Œç‰¹æ€§

### ç®€åŒ–çš„æ¨¡å‹å¡«å……

é™¤äº†ä¼ å…¥é—­åŒ…ï¼Œç°åœ¨ä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œæ¥åˆ†åˆ«ä¸ºé”®å€¼å¯¹æ¨¡å‹æˆ–é›†åˆæ¨¡å‹è¿›è¡Œå¡«å……ã€‚

```js
// é”®å€¼å¯¹æ¨¡å‹
this.seed({
  foo: 'bar',
  baz: 'qux',
});
// ç›¸å½“äºï¼š
this.seed(() => {
  this.data.foo = 'bar';
  this.data.baz = 'qux';
});
```

```js
// é›†åˆæ¨¡å‹
this.seed(['foo', 'bar']);
// ç›¸å½“äºï¼š
this.seed(() => {
  this.insert('foo');
  this.insert('bar');
});
```

### è‡ªåŠ¨è®¢é˜…åŠŸèƒ½

å½“é—­åŒ…ä¸­æ‰€ä½¿ç”¨çš„å€¼æœ‰ä»»ä¸€è¢«æ›´æ”¹æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡æ­¤é—­åŒ…ï¼š

```js
auto$(() => {
  console.log(configState.data.foo);
  console.log(configState.data.bar);
});
```

## æ¨¡å‹é©±åŠ¨å˜åŒ–

> ğŸ“œ è¦ä½¿ç”¨ Kurimudb 4.x ç‰ˆæœ¬ï¼Œéœ€è¦å°†æ‰€æœ‰é©±åŠ¨çš„ç‰ˆæœ¬åŒæ ·å‡çº§åˆ° 4.xã€‚

### LocalStorage

LocalStorage é©±åŠ¨ç°åœ¨æ”¯æŒä½¿ç”¨ `all()` å‡½æ•°äº†ã€‚

### Dexie

Dexie é©±åŠ¨çš„ `db` å‚æ•°ä¼ å…¥ä½ç½®ï¼Œä»åŸå…ˆçš„å®šä¹‰ä¸€ä¸ª**ç±»æˆå‘˜å˜é‡**ï¼Œå˜æ›´ä¸ºåœ¨**æ„é€ å‡½æ•°**ä¸­å®šä¹‰ã€‚

```js {3}
// 3.x ç‰ˆæœ¬
export default new class NoteList extends Models.collection {
  db: Dexie = db;

  constructor() {
    super({
      // ...
    });
  }
};
```

```js {6}
// 4.x ç‰ˆæœ¬
export default new class NoteList extends Models.collection {
  constructor() {
    super({
      // ...
      db: db,
    });
  }
};
```